#!/usr/bin/env bash

dot_dir=$(dirname $(readlink -f $BASH_SOURCE[0]))
core_number=$(cat /proc/cpuinfo | grep -c processor)

echo Creating directories...
mkdir -p ~/.ssh

echo Creating symlinks...
ln -sf $dot_dir/vim/bootstrap.vim ~/.vimrc
ln -sf $dot_dir/vim ~/.vim
ln -sf $dot_dir/bash/bashrc ~/.bashrc
ln -sf $dot_dir/tmux/tmux.conf ~/.tmux.conf
ln -sf $dot_dir/tmux ~/.tmux
ln -sf $dot_dir/git/config ~/.gitconfig
ln -sf $dot_dir/ssh/config ~/.ssh/config
ln -sf $dot_dir/i3 ~/.config/i3
ln -sf $dot_dir/termite ~/.config/termite

echo Installing vim plugins...
vim +PluginInstall +qall

echo Building YCM...
pushd $dot_dir/vim/bundle/YouCompleteMe >/dev/null
git submodule update --init --recursive
./install.py --clang-completer
popd >/dev/null

echo Building color_coded...
pushd $dot_dir/vim/bundle/color_coded >/dev/null
mkdir -p build
cd build
cmake ..
make -j$core_number && make install
popd >/dev/null

echo Compiling tmux config...
cd $dot_dir/tmux
make tmux.conf
cd - >/dev/null

echo Compiling tmux plugins...
pushd $dot_dir/tmux >/dev/null
git clone https://github.com/thewtex/tmux-mem-cpu-load
cd tmux-mem-cpu-load
mkdir -p build
cd build
cmake ..
make
ln -sf ${PWD}/tmux-mem-cpu-load ~/.tmux-mem-cpu-load
popd

echo Installing OMF...
curl -L https://get.oh-my.fish | fish
echo omf theme dangerous | fish

echo Setup complete.

